<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=manifest href=/images/site.webmanifest><title>Week 6 - Normalization and Different Keys</title><meta name=description content="2019 Humber Database Course"><meta name=author content="Simon Borer"><link rel=stylesheet href=https://www.dbcourse2019.com/sass/slides/main-slides.min.8d906c197688c31feb21f74c1957127d2d8db8fe27a3226d390f571c6e7d4e14.css><link rel=stylesheet href=/css/codemirror.css></head><body><div class=reveal><div class=slides><section class=slide-only><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Happy Monday!</h2></div></div></section><section id="<%- page.today[0].id %>"><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2><%- page.today[0].title %></h2><p>It's time for us to take the next step beyond creating a database. It's time to <em>design</em> a database.</p></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Steps for designing a database</h2><ol><li>Identify data</li><li>Simplify data</li><li>Divide into tables and columns</li><li>Choose primary & foreign keys</li><li>Normalize</li><li>Index</li></ol></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Identifying data</h2><p>So far we've gotten datasets where the data has been selected for us. However, when designing a database, you'll often have to make descisions about what kinds of data are needed.</p><p>Can you identify what the data that we might need to store when setting up a typical e-commerce site?</p><div class="callout primary"><p>Try thinking first about the data <em>entities</em> (people, events, objects, etc.) that are important.</p></div></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Simplifying data</h2><p>In this step, we break down our data into the smallest necessary pieces.</p><p>It's important to think of the current <strong>and potential future</strong> use-cases for the data.</p><p>How would you break down an address?</p><code>John Doe, 143 Humber Blvd., Rm 205, Toronto, ON, M7V 3X6</code></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Dividing into tables and columns</h2><p>Tables are for <em>entities</em>.</p><p>Columns are for <em>attributes</em>.</p><p>Rows are for <em>instances</em>.</p><p>For example, if I need to keep track of people's phone numbers, the people are the entity, the numbers are the attribute, and the rows are the instances.</p></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Choosing keys</h2><p>Sometimes, there will be an obvious attribute (column) that acts as a 'fingerprint' for each instance (row).</p><p>Most times, however, you'll need to create your primary key from scratch. This is a good thing - it means that your primary key doesn't need to worry about being anything but your primary key.</p><p>To create a foreign key, you'll need to look at two entities (tables) that have a relationship, where one of them has unique records that can be referenced by the other.</p></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Normalization</h2><p>Normalization is a the process of separating your data to reduce redundancy.</p><p>Most of the tables we've worked with so far are already normalized.</p></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><p>Normalization is required when you have repeating columns.</p><p>If we had a table that contained one row for each person registered at the library, with columns for each book that they are currently borrowing, that table would need normalization.</p><table><tbody><tr><td>first name</td><td>last name</td><td>card number</td><td>book_1</td><td>book_2</td><td>...</td></tr></tbody></table></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><p>Normalization is required when you have redundant data.</p><p>If we had a table that had a record for every time anyone took a book out of the library, that table would need normalization.</p><table><tbody><tr><td>first name</td><td>last name</td><td>card number</td><td>book</td><td>date</td></tr></tbody></table></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><ul><li>Each registered person</li><li>Each book</li><li>Each instance of a book being borrowed</li></ul></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Why three tables?</h2><p>If we were to try to build our library table with <em>only</em> one table for registered people and one table for each book, that would create a <em>many-to-many</em> relationship - many people can take out one book, and many books can be taken out by one person.</p><p>To keep track of who took out which book, we'd have to have multiple columns of an indeterminate number, i.e. borrowed_book_1, borrowed_book_2, etc.</p><p>When we design our databases, we resolve these many-to-many relationships with <em>bridging tables</em>. In this case, a table for each time a book is borrowed that references <em>both</em> the books table and the people table.</p></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2>Creating tables</h2><p>Last week we covered the basics of creating, altering and dropping a table, as well as inserting data, updating columns, etc.</p><p>There's two more statements, and one more handy tool we can use!</p><p>First, the tool...</p></div></div></section><section id="<%- page.today[1].id %>"><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2><code>SEQUENCE</code></h2><p>A sequence is a thing we can make!</p><pre><code class=language-sql>CREATE SEQUENCE my_sequence</code></pre><p>A sequence is just that - a series of numbers that gets generated as you need them.</p></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><p>If you need a primary key, don't write them out by hand - just create a sequence! You sequence will keep track if you want to add rows later.</p><pre><code class=language-sql>INSERT INTO new_students 
VALUES (
    my_sequence.NEXTVAL, 
    'Voorhees', 
    'Pamela', 
    '3.71'
)</code></pre></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><p>You can <code>ALTER</code> or <code>DROP</code> your sequences, just like you would a table.</p><p>You can also check the dual table to see what number you're on:</p><pre><code class=language-sql>SELECT my_new_seq.CURRVAL
FROM dual</code></pre></div></div></section><section id="<%- page.today[2].id %>"><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2><code>COMMIT</code> & <code>ROLLBACK</code></h2><p>Two basic transaction control statements are <code>COMMIT</code> and <code>ROLLBACK</code>. As usual with SQL, you can probably guess what they do!</p><p>When you run <code>COMMIT</code>, the changes you've made to your data are saved to the database.</p><p>When you <code>ROLLBACK</code>, the changes you've made are removed, back to the last commit.</p><div class="callout primary">Note that, in Oracle, DDL statements like <code>CREATE</code> and <code>DROP</code> are committed automatically. You'll only need to commit when using Data Manipulation Language commands like <code>INSERT</code>, <code>UPDATE</code>, or <code>DELETE</code></div></div></div></section><section id="<%- page.today[3].id %>"><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>First look at PL/SQL</h2><p>After the midterm, we'll look at scripting in Oracle, using the PL/SQL language. This way we can create scripts to work on the database instead of running individual statements ourselves!</p><p>At the beginning of the year we ran some scripts, which at this point, we should be able to read.</p><p>Take a look at <a href="<%= basePath %>/assets/documents/create_ap_tables.sql" target=_blank>create_ap_tables.sql</a></p></div></div></section><section id="<%- page.today[4].id %>"><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Midterm prep</h2><p>Let's work with the invoices table to prep for the midterm.</p><p>The midterm <em>may</em> include content from <em>any</em> of our classes.</p><p>If you know your way around the different table joins and summary functions, you'll probably be ok.</p><p>What we cover today will have a couple of additions/clarifications, but mostly we'll be going over stuff we've talked about already.</p></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><p>In this example, we use a <code>JOIN</code> to find all vendors with an unpaid invoice:</p><pre><code class=language-sql>-- Select all columns from vendors
SELECT DISTINCT v.*
-- Left join vendors and invoices
FROM vendors v
LEFT JOIN invoices i
    ON v.vendor_id = i.vendor_id
-- Filter for an invoice id with no payment date
WHERE payment_date IS NULL
    AND invoice_id IS NOT NULL</code></pre></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><p>In this example, we check for invoices due between June 1st and 30th:</p><pre><code class=language-sql>SELECT invoice_id 
FROM invoices
WHERE invoice_due_date 
    BETWEEN TO_DATE('2014-06-01', 'YYYY-MM-DD')
        AND TO_DATE('2014-06-30', 'YYYY-MM-DD')</code></pre></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><p>In this example, we format a summary query to make a readable output showing vendors that have a balance owing.</p><pre><code class=language-sql>SELECT v.vendor_name 
    || ' owes us $' 
    || SUM(invoice_total - payment_total - credit_total) 
    AS "Who owes what"
FROM invoices i
JOIN vendors v ON i.vendor_id = v.vendor_id
WHERE invoice_total - payment_total - credit_total > 0
GROUP BY v.vendor_id, v.vendor_name</code></pre></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><p>In this example, we see what vendors have more than 2 invoices.</p><pre><code class=language-sql>SELECT 
    vendor_id AS "Vendor ID", 
    COUNT(invoice_id) AS "Invoices"
FROM vendors
JOIN invoices
    USING(vendor_id)
GROUP BY vendor_id
HAVING COUNT(invoice_id) > 2
ORDER BY "Invoices" DESC</code></pre></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>The Feynmann technique</h2><p>The Feynmann technique is a way to study. It's very simple and effective.</p><ol><li>Without looking at your notes, write down an explanation of the concept you want to study. Write it as though you're teaching it, using plain language. The purpose of this is identify what you know and what you don't know.</li><li>Whatever you don't know, look up. Repeat step 1.</li></ol></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Sans Forgetica</h2><p><a href=https://sansforgetica.rmit/ target=_blank>Sans Forgetica</a> is a font developed by a multidisciplinary team of designers and behavioural scientists from Australia's RMIT university.</p><p>It is designed to act as a study aid, improving recall.</p><script type=text/javascript>document.addEventListener('click',function(event){if(!event.target.matches('#sansF'))return;event.preventDefault();const cList=document.body.classList;if(cList.contains("forgetica")){cList.remove("forgetica")}else{cList.add("forgetica")}},false);</script></div></div></section><section><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><h2 class=h2>Assignment time!</h2><p class=slide-only>See <a href="<%= site.basePath %>/notes/week-5/index.html#lab" target=_blank>notes<span class=show-for-sr> Opens in a new tab</span></a></p></div></div></section><section id=lab class=post-only><div class=grid-x><div class="cell large-6 large-offset-3 medium-10 medium-offset-1"><p>As this is prep for your midterm, try doing as much as you can without looking at the notes.</p><ol><li>Write a query that uses an alias</li><li>Write a query that concatenates two column names and a string</li><li>Query the dual table to divide the sum of 848 and 1126 from the sum of 45 plus 2 (using the order of operations)</li><li>Write a query that excludes rows based on a pattern. This pattern should match more than one value.</li><li>Write a query that sorts things by the third last letter</li><li>Using <code>dual</code>, <em>and without hardcoding the current date</em>, find out how many days are between now and Hallowe'en, rounded off to the full day</li><li>Write a query that shows all the invoices if they don't have a listing in <code>invoice_line_items</code></li><li>Write a query that joins invoices, vendors, and vendor_contacts that won't exclude any rows from any of the tables</li><li>Write a query that counts how many invoices there are</li><li>Write a query that gets a list of all the vendors with no invoices</li><li>Write a query that lists all the vendor names, and if they have invoices, list the line item description.</li><li>Write a query that gets the average balance owing from all invoices</li><li>Write a query that gets the sum of all the invoices in the month of July (any year)</li><li>Write a query that gets all the vendor ids, along with the most and least they've paid on an invoice, assuming those two numbers are different</li><li>Write a query that gets all the invoices where the credit total is more than average</li><li>Create a table of books. Include books with more than one author. Include all the information you think a library might use.</li><li>Create a table of authors. Include authors who have written more than one book in the previous table. Update the previous table if necessary.</li><li>Create a bridging table between the two. Write statements to update the previous tables if necessary.</li></ol></div></div></section></div></div><script type=text/javascript src=/js/reveal.js></script><script>Reveal.initialize({dependencies:[{src:'/js/highlight.js',async:true,callback:function(){hljs.initHighlightingOnLoad();}},{src:'/js/reveal-a11y.js',async:true,condition:function(){return!!document.body.classList;}}]});</script></body></html>